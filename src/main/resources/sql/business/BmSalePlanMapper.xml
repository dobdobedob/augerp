<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.happyjob.study.business.dao.BmSalePlaneDao">

	<!-- 그룹코드 목록 조회 -->
	<select id="listBmSalePlaneModel" resultType="kr.happyjob.study.business.model.BmSalePlanModel">
	/*kr.happy.study.business.dao.BmSalePlaneDao.BmSalePlanModel*/
	  select pl.pln_no
	       , pl.loginID
	       , u.name
	       , DATE_FORMAT(pl.pln_ddate, '%Y-%m') as pln_ddate
	       , pl.si_cd
	       , si.si_nm
	       , pl.pln_nmt
	       , DATE_FORMAT(pl.pln_date, '%Y-%m-%d') as pln_date
	       , pl.pln_etc
	       , dep.dept_name
	       , pl.pln_ar
        from tb_planning pl
             inner join tb_userinfo u on pl.loginID = u.loginID
             inner join tb_sitem si on pl.si_cd = si.si_cd
             inner join tb_dept dep on u.dept_cd = dep.dept_cd
        <where>
	       <if test="(prolall != null) and (!prolall.equals(''))">
	            and si.bi_cd like (#{prolall})
	       </if>  
	       <if test="(promall != null) and (!proall.equals(''))">
	            and si.mi_cd like (#{promall})
	       </if>	                  
	       <if test="(proall != null) and (!proall.equals(''))">
	            and si.si_cd like (#{proall})
	       </if>	       
           <if test="(search != null) and (!search.equals(''))">
	            and u.name like concat('%',#{title} ,'%')
	       </if>
	       <if test="(to_month != null) and (!to_month.equals(''))">
	            and pln_ddate <![CDATA[=]]> STR_TO_DATE(concat(#{to_month},'-01'),'%Y-%m-%d')  
	       </if>
	   </where> 
       order by pl.pln_nmt DESC
       limit #{pageIndex}, #{pageSize}
	</select>

	<!-- 전체 그룹갯수 카운트 -->
	<select id="totBmSalePlanModel" resultType="int">
	/*kr.happy.study.business.dao.BmSalePlaneDao.BmSalePlanModel*/
	  select count(*)
	    from tb_planning pl
	         inner join tb_userinfo u on pl.loginID = u.loginID
             inner join tb_sitem si on pl.si_cd = si.si_cd
        <where>
	       <if test="(prolall != null) and (!prolall.equals(''))">
	            and si.bi_cd like (#{prolall})
	       </if> 
	       <if test="(promall != null) and (!proall.equals(''))">
	            and si.mi_cd like (#{promall})
	       </if>	                   
	       <if test="(proall != null) and (!proall.equals(''))">
	            and si.si_cd like (#{proall})
	       </if>        
           <if test="(search != null) and (!search.equals(''))">
	            and u.name like concat('%',#{title} ,'%')
	       </if>
	       <if test="(to_month != null) and (!to_month.equals(''))">
	            and pln_ddate <![CDATA[=]]> STR_TO_DATE(concat(#{to_month},'-01'),'%Y-%m-%d')  
	       </if>		    
	   </where> 
	</select>


	
</mapper>

