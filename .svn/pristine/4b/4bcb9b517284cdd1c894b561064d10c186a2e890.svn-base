<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.happyjob.study.system.dao.NoticeDao">

	<!-- 그룹코드 목록 조회 -->
	<select id="listNoticeModel" resultType="kr.happyjob.study.system.model.NoticeModel">
		/*kr.happy.study.system.dao.NoticeDao.listNoticeModel*/
		  select an.ann_no
			     , an.loginID
			     , ui.name as writer
			     , an.ann_title
			     , an.ann_con
			     , an.ann_cnt
			     , DATE_FORMAT(an.ann_date, '%Y-%m-%d') as ann_date
		   from tb_announce an
		          inner join tb_userinfo ui on ui.loginID = an.loginID
		   <where>
		       <if test="(title != null) and (!title.equals(''))">
		            and an.ann_title like concat('%',#{title} ,'%')
		       </if>
		       <if test="(from_date != null) and (!from_date.equals(''))">
		            and an.ann_date <![CDATA[>=]]> STR_TO_DATE(#{from_date}, '%Y-%m-%d')  
		       </if>
		       <if test="(to_date != null) and (!to_date.equals(''))">
		            and an.ann_date <![CDATA[<=]]> STR_TO_DATE(#{to_date}, '%Y-%m-%d')  
		       </if>		    
		   </where> 
		  order by an.ann_date DESC
		   limit #{pageIndex}, #{pageSize}
	</select>
	
    <select id="totNoticeModel" resultType="int">
		/*kr.happy.study.system.dao.NoticeDao.totNoticeModel*/
		  select count(*)
		   from tb_announce
		   <where>
		       <if test="(title != null) and (!title.equals(''))">
		            and ann_title like concat('%',#{title} ,'%')
		       </if>
		       <if test="(from_date != null) and (!from_date.equals(''))">
		            and ann_date <![CDATA[>=]]> STR_TO_DATE(#{from_date}, '%Y-%m-%d')  
		       </if>
		       <if test="(to_date != null) and (!to_date.equals(''))">
		            and ann_date <![CDATA[<=]]> STR_TO_DATE(#{to_date}, '%Y-%m-%d')  
		       </if>		    
		   </where> 
	</select>		
	
	<select id="selectnotice" resultType="kr.happyjob.study.system.model.NoticeModel">
	      /*kr.happy.study.system.dao.NoticeDao.selectnotice*/
          select ann_no
			     , loginID
			     , ann_title
			     , ann_con
			     , ann_cnt
			     , DATE_FORMAT(ann_date, '%Y-%m-%d') as ann_date	      
	      from  tb_announce
	     where ann_no = #{ann_no}
	</select>
	
	<update id="updatenoticereadcnt">
	     /*kr.happy.study.system.dao.NoticeDao.updatenoticereadcnt*/
	     update tb_announce
	          set  ann_cnt = ifnull(ann_cnt,0) + 1 
	      where ann_no = #{ann_no}
	</update>	
	
	<insert id="insertnotice">
	    <selectKey resultType="int" keyProperty="ann_no" order="BEFORE">
            select ifnull(max(ann_no),0) + 1 from tb_announce
        </selectKey>			 
		  insert into tb_announce
		      (
		           ann_no
		         , loginID
		         , ann_title
		         , ann_con
		         , ann_cnt
		         , ann_date
		      ) values (
		          #{ann_no}
		         ,#{loginId}
		         ,#{noticeTitle}
		         ,#{noticeContent}
		         ,0
		         ,now()
		      )
	</insert>
	
	<update id="updatenotice">	
			 update tb_announce
			      set  loginID = #{loginId}
		              , ann_title = #{noticeTitle}
		              , ann_con = #{noticeContent}
		              , ann_date = now()
			  where ann_no = #{annno}  
	</update>
	
	
	
</mapper>